2025-06-15 20:01:43.922 +05:30 [ERR] An error occurred using the connection to database 'FitnessDB' on server 'tcp://localhost:5432'.
2025-06-15 20:01:44.430 +05:30 [INF] Executed DbCommand (230ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE DATABASE "FitnessDB";
2025-06-15 20:01:44.516 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE IF NOT EXISTS "__EFMigrationsHistory" (
    "MigrationId" character varying(150) NOT NULL,
    "ProductVersion" character varying(32) NOT NULL,
    CONSTRAINT "PK___EFMigrationsHistory" PRIMARY KEY ("MigrationId")
);
2025-06-15 20:01:44.524 +05:30 [INF] Acquiring an exclusive lock for migration application. See https://aka.ms/efcore-docs-migrations-lock for more information if this takes too long.
2025-06-15 20:01:44.527 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
LOCK TABLE "__EFMigrationsHistory" IN ACCESS EXCLUSIVE MODE
2025-06-15 20:01:44.530 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
SELECT "MigrationId", "ProductVersion"
FROM "__EFMigrationsHistory"
ORDER BY "MigrationId";
2025-06-15 20:01:44.541 +05:30 [INF] Applying migration '20250609090151_init'.
2025-06-15 20:01:44.578 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Users" (
    "Email" text NOT NULL,
    "Role" text NOT NULL,
    "Password" bytea,
    "HashKey" bytea,
    CONSTRAINT "PK_Users" PRIMARY KEY ("Email")
);
2025-06-15 20:01:44.582 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Client" (
    "Id" uuid NOT NULL,
    "Name" text NOT NULL,
    "Age" integer NOT NULL,
    "Phone" text NOT NULL,
    "Email" text NOT NULL,
    CONSTRAINT "PK_Client" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_Client_Users_Email" FOREIGN KEY ("Email") REFERENCES "Users" ("Email") ON DELETE CASCADE
);
2025-06-15 20:01:44.585 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Coach" (
    "Id" uuid NOT NULL,
    "Name" text NOT NULL,
    "YearsOfExperience" real NOT NULL,
    "Email" text NOT NULL,
    "Phone" text NOT NULL,
    CONSTRAINT "PK_Coach" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_Coach_Users_Email" FOREIGN KEY ("Email") REFERENCES "Users" ("Email") ON DELETE CASCADE
);
2025-06-15 20:01:44.588 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Progress" (
    "Id" uuid NOT NULL,
    "ClientId" uuid NOT NULL,
    "ImagePath" text NOT NULL,
    "Height" real NOT NULL,
    "Weight" real NOT NULL,
    "UploadedAt" timestamp with time zone NOT NULL,
    CONSTRAINT "PK_Progress" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_Progress_Client_ClientId" FOREIGN KEY ("ClientId") REFERENCES "Client" ("Id") ON DELETE CASCADE
);
2025-06-15 20:01:44.590 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "DietPlans" (
    "Id" uuid NOT NULL,
    "CoachId" uuid NOT NULL,
    "DietTitle" text NOT NULL,
    CONSTRAINT "PK_DietPlans" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_DietPlans_Coach_CoachId" FOREIGN KEY ("CoachId") REFERENCES "Coach" ("Id") ON DELETE CASCADE
);
2025-06-15 20:01:44.593 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "WorkoutPlan" (
    "Id" uuid NOT NULL,
    "CoachId" uuid NOT NULL,
    "Title" text NOT NULL,
    "Description" text NOT NULL,
    "DurationInWeeks" integer NOT NULL,
    CONSTRAINT "PK_WorkoutPlan" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_WorkoutPlan_Coach_CoachId" FOREIGN KEY ("CoachId") REFERENCES "Coach" ("Id") ON DELETE CASCADE
);
2025-06-15 20:01:44.597 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "DietMeal" (
    "Id" uuid NOT NULL,
    "DietPlanId" uuid NOT NULL,
    "MealType" text NOT NULL,
    "Description" text NOT NULL,
    "Calories" integer NOT NULL,
    "ProteinGrams" integer NOT NULL,
    "CarbsGrams" integer NOT NULL,
    "FatGrams" integer NOT NULL,
    CONSTRAINT "PK_DietMeal" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_DietMeal_DietPlans_DietPlanId" FOREIGN KEY ("DietPlanId") REFERENCES "DietPlans" ("Id") ON DELETE CASCADE
);
2025-06-15 20:01:44.599 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "PlanAssignment" (
    "Id" uuid NOT NULL,
    "ClientId" uuid NOT NULL,
    "WorkoutPlanId" uuid,
    "DietPlanId" uuid,
    "AssignedByCoachId" uuid NOT NULL,
    "AssignedOn" timestamp with time zone NOT NULL,
    CONSTRAINT "PK_PlanAssignment" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_PlanAssignment_Client_ClientId" FOREIGN KEY ("ClientId") REFERENCES "Client" ("Id") ON DELETE CASCADE,
    CONSTRAINT "FK_PlanAssignment_Coach_AssignedByCoachId" FOREIGN KEY ("AssignedByCoachId") REFERENCES "Coach" ("Id") ON DELETE RESTRICT,
    CONSTRAINT "FK_PlanAssignment_DietPlans_DietPlanId" FOREIGN KEY ("DietPlanId") REFERENCES "DietPlans" ("Id") ON DELETE SET NULL,
    CONSTRAINT "FK_PlanAssignment_WorkoutPlan_WorkoutPlanId" FOREIGN KEY ("WorkoutPlanId") REFERENCES "WorkoutPlan" ("Id") ON DELETE SET NULL
);
2025-06-15 20:01:44.602 +05:30 [INF] Executed DbCommand (3ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "WorkoutExercise" (
    "Id" uuid NOT NULL,
    "WorkoutPlanId" uuid NOT NULL,
    "Name" text NOT NULL,
    "Sets" integer NOT NULL,
    "Reps" integer NOT NULL,
    "RestSeconds" integer NOT NULL,
    "Notes" text NOT NULL,
    CONSTRAINT "PK_WorkoutExercise" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_WorkoutExercise_WorkoutPlan_WorkoutPlanId" FOREIGN KEY ("WorkoutPlanId") REFERENCES "WorkoutPlan" ("Id") ON DELETE CASCADE
);
2025-06-15 20:01:44.607 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE TABLE "Workout" (
    "Id" uuid NOT NULL,
    "ClientId" uuid NOT NULL,
    "Date" timestamp with time zone NOT NULL,
    "Description" text NOT NULL,
    "PlanAssignmentId" uuid,
    CONSTRAINT "PK_Workout" PRIMARY KEY ("Id"),
    CONSTRAINT "FK_Workout_Client_ClientId" FOREIGN KEY ("ClientId") REFERENCES "Client" ("Id") ON DELETE CASCADE,
    CONSTRAINT "FK_Workout_PlanAssignment_PlanAssignmentId" FOREIGN KEY ("PlanAssignmentId") REFERENCES "PlanAssignment" ("Id")
);
2025-06-15 20:01:44.608 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX "IX_Client_Email" ON "Client" ("Email");
2025-06-15 20:01:44.611 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE UNIQUE INDEX "IX_Coach_Email" ON "Coach" ("Email");
2025-06-15 20:01:44.613 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_DietMeal_DietPlanId" ON "DietMeal" ("DietPlanId");
2025-06-15 20:01:44.614 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_DietPlans_CoachId" ON "DietPlans" ("CoachId");
2025-06-15 20:01:44.616 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_PlanAssignment_AssignedByCoachId" ON "PlanAssignment" ("AssignedByCoachId");
2025-06-15 20:01:44.618 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_PlanAssignment_ClientId" ON "PlanAssignment" ("ClientId");
2025-06-15 20:01:44.620 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_PlanAssignment_DietPlanId" ON "PlanAssignment" ("DietPlanId");
2025-06-15 20:01:44.621 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_PlanAssignment_WorkoutPlanId" ON "PlanAssignment" ("WorkoutPlanId");
2025-06-15 20:01:44.623 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_Progress_ClientId" ON "Progress" ("ClientId");
2025-06-15 20:01:44.626 +05:30 [INF] Executed DbCommand (2ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_Workout_ClientId" ON "Workout" ("ClientId");
2025-06-15 20:01:44.627 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_Workout_PlanAssignmentId" ON "Workout" ("PlanAssignmentId");
2025-06-15 20:01:44.628 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_WorkoutExercise_WorkoutPlanId" ON "WorkoutExercise" ("WorkoutPlanId");
2025-06-15 20:01:44.630 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
CREATE INDEX "IX_WorkoutPlan_CoachId" ON "WorkoutPlan" ("CoachId");
2025-06-15 20:01:44.631 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20250609090151_init', '9.0.5');
2025-06-15 20:01:44.631 +05:30 [INF] Applying migration '20250610181726_AddRefreshTokenFieldsToUser'.
2025-06-15 20:01:44.650 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Users" ADD "RefreshToken" text NOT NULL DEFAULT '';
2025-06-15 20:01:44.651 +05:30 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "Users" ADD "RefreshTokenExpiryTime" timestamp with time zone NOT NULL DEFAULT TIMESTAMPTZ '-infinity';
2025-06-15 20:01:44.653 +05:30 [INF] Executed DbCommand (1ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
ALTER TABLE "PlanAssignment" ADD "CompletionStatus" text NOT NULL DEFAULT '';
2025-06-15 20:01:44.653 +05:30 [INF] Executed DbCommand (0ms) [Parameters=[], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "__EFMigrationsHistory" ("MigrationId", "ProductVersion")
VALUES ('20250610181726_AddRefreshTokenFieldsToUser', '9.0.5');
2025-06-15 20:02:03.170 +05:30 [INF] User profile is available. Using '/Users/presidio/.aspnet/DataProtection-Keys' as key repository; keys will not be encrypted at rest.
2025-06-15 20:02:03.250 +05:30 [INF] Creating key {4264249c-f733-4a04-a7ff-a4b0e4f182c5} with creation date 2025-06-15 14:32:03Z, activation date 2025-06-15 14:32:03Z, and expiration date 2025-09-13 14:32:03Z.
2025-06-15 20:02:03.261 +05:30 [WRN] No XML encryptor configured. Key {4264249c-f733-4a04-a7ff-a4b0e4f182c5} may be persisted to storage in unencrypted form.
2025-06-15 20:02:03.266 +05:30 [INF] Writing data to file '/Users/presidio/.aspnet/DataProtection-Keys/key-4264249c-f733-4a04-a7ff-a4b0e4f182c5.xml'.
2025-06-15 20:02:03.331 +05:30 [INF] Now listening on: http://localhost:5002
2025-06-15 20:02:03.333 +05:30 [INF] Application started. Press Ctrl+C to shut down.
2025-06-15 20:02:03.333 +05:30 [INF] Hosting environment: Development
2025-06-15 20:02:03.333 +05:30 [INF] Content root path: /Users/presidio/Desktop/GensparkTraining/Fitness Tracker API/FitnessTrackerAPI
2025-06-15 20:02:37.512 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:5002/api/v1/Client - application/json 113
2025-06-15 20:02:37.574 +05:30 [INF] API Call: POST /api/v1/Client by anonymous at "2025-06-15T14:32:37.5726820Z"
2025-06-15 20:02:37.678 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '09/06/2025 6:54:58 AM', Current time (UTC): '15/06/2025 2:32:37 PM'.
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-06-15 20:02:37.694 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '09/06/2025 6:54:58 AM', Current time (UTC): '15/06/2025 2:32:37 PM'.
2025-06-15 20:02:37.697 +05:30 [INF] Executing endpoint 'FitnessTrackerAPI.Controllers.ClientController.PostClient (FitnessTrackerAPI)'
2025-06-15 20:02:37.717 +05:30 [INF] Route matched with {action = "PostClient", controller = "Client"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[FitnessTrackerAPI.Models.DTOs.SignUpResponseDTO]] PostClient(FitnessTrackerAPI.Models.DTOs.ClientAddRequestDTO) on controller FitnessTrackerAPI.Controllers.ClientController (FitnessTrackerAPI).
2025-06-15 20:02:38.003 +05:30 [INF] Executing BadRequestObjectResult, writing value of type 'Microsoft.AspNetCore.Mvc.ValidationProblemDetails'.
2025-06-15 20:02:38.035 +05:30 [INF] Executed action FitnessTrackerAPI.Controllers.ClientController.PostClient (FitnessTrackerAPI) in 314.2636ms
2025-06-15 20:02:38.049 +05:30 [INF] Executed endpoint 'FitnessTrackerAPI.Controllers.ClientController.PostClient (FitnessTrackerAPI)'
2025-06-15 20:02:38.052 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:5002/api/v1/Client - 400 null application/problem+json; charset=utf-8 541.4335ms
2025-06-15 20:02:44.566 +05:30 [INF] Request starting HTTP/1.1 POST http://localhost:5002/api/v1/Client - application/json 116
2025-06-15 20:02:44.569 +05:30 [INF] API Call: POST /api/v1/Client by anonymous at "2025-06-15T14:32:44.5691980Z"
2025-06-15 20:02:44.570 +05:30 [INF] Failed to validate the token.
Microsoft.IdentityModel.Tokens.SecurityTokenExpiredException: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '09/06/2025 6:54:58 AM', Current time (UTC): '15/06/2025 2:32:44 PM'.
   at Microsoft.IdentityModel.Tokens.Validators.ValidateLifetime(Nullable`1 notBefore, Nullable`1 expires, SecurityToken securityToken, TokenValidationParameters validationParameters)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateTokenPayloadAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
   at Microsoft.IdentityModel.JsonWebTokens.JsonWebTokenHandler.ValidateJWSAsync(JsonWebToken jsonWebToken, TokenValidationParameters validationParameters, BaseConfiguration configuration)
2025-06-15 20:02:44.571 +05:30 [INF] Bearer was not authenticated. Failure message: IDX10223: Lifetime validation failed. The token is expired. ValidTo (UTC): '09/06/2025 6:54:58 AM', Current time (UTC): '15/06/2025 2:32:44 PM'.
2025-06-15 20:02:44.571 +05:30 [INF] Executing endpoint 'FitnessTrackerAPI.Controllers.ClientController.PostClient (FitnessTrackerAPI)'
2025-06-15 20:02:44.571 +05:30 [INF] Route matched with {action = "PostClient", controller = "Client"}. Executing controller action with signature System.Threading.Tasks.Task`1[Microsoft.AspNetCore.Mvc.ActionResult`1[FitnessTrackerAPI.Models.DTOs.SignUpResponseDTO]] PostClient(FitnessTrackerAPI.Models.DTOs.ClientAddRequestDTO) on controller FitnessTrackerAPI.Controllers.ClientController (FitnessTrackerAPI).
2025-06-15 20:02:45.802 +05:30 [INF] Executed DbCommand (58ms) [Parameters=[@__key_0='?'], CommandType='"Text"', CommandTimeout='30']
SELECT u."Email", u."HashKey", u."Password", u."RefreshToken", u."RefreshTokenExpiryTime", u."Role"
FROM "Users" AS u
WHERE u."Email" = @__key_0
LIMIT 2
2025-06-15 20:02:46.264 +05:30 [INF] Executed DbCommand (8ms) [Parameters=[@p0='?', @p1='?' (DbType = Binary), @p2='?' (DbType = Binary), @p3='?', @p4='?' (DbType = DateTime), @p5='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Users" ("Email", "HashKey", "Password", "RefreshToken", "RefreshTokenExpiryTime", "Role")
VALUES (@p0, @p1, @p2, @p3, @p4, @p5);
2025-06-15 20:02:46.338 +05:30 [INF] Executed DbCommand (4ms) [Parameters=[@p0='?' (DbType = Guid), @p1='?' (DbType = Int32), @p2='?', @p3='?', @p4='?'], CommandType='"Text"', CommandTimeout='30']
INSERT INTO "Client" ("Id", "Age", "Email", "Name", "Phone")
VALUES (@p0, @p1, @p2, @p3, @p4);
2025-06-15 20:02:46.357 +05:30 [INF] Executing CreatedResult, writing value of type 'FitnessTrackerAPI.Models.DTOs.SignUpResponseDTO'.
2025-06-15 20:02:46.368 +05:30 [INF] Executed action FitnessTrackerAPI.Controllers.ClientController.PostClient (FitnessTrackerAPI) in 1796.9367ms
2025-06-15 20:02:46.369 +05:30 [INF] Executed endpoint 'FitnessTrackerAPI.Controllers.ClientController.PostClient (FitnessTrackerAPI)'
2025-06-15 20:02:46.379 +05:30 [INF] Request finished HTTP/1.1 POST http://localhost:5002/api/v1/Client - 201 null application/json; charset=utf-8 1812.954ms
2025-06-15 20:02:53.525 +05:30 [INF] Application is shutting down...
